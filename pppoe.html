<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AzintexNMP</title>

    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Custom style -->
	<link rel="stylesheet"  href="css/dashboard.css">
	<!-- FooTable -->
	<link rel="stylesheet" href="css/footable.bootstrap.min.css">
	<!-- Input mask -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/css/inputmask.css">
	<!-- Bootstrapswitch -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.4/css/bootstrap3/bootstrap-switch.min.css">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://85.132.64.10/ftbl/">AzintexNMP</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
			<li><a href="http://85.132.64.10/ftbl/accounting.html">Accounting</a></li>
            <li><a href="http://85.132.64.10/ftbl/pppoe.html">PPPoE</a></li>
            <li><a href="#">IPoE</a></li>
            <li><a href="#">Static</a></li>
            <li><a href="#">Locations</a></li>
			<li><a href="#">Inventory</a></li>
			<li><a href="#">Log</a></li>
			<li><a href="#">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>
	
	<table id="fooTable" class="table"></table>

<div class="modal fade" id="editor-modal" tabindex="-1" role="dialog" aria-labelledby="editor-title">
	<div class="modal-dialog" role="document">
		<form class="modal-content form-horizontal" id="editor">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
				<h4 class="modal-title" id="editor-title">Add Row</h4>
			</div>
			<div class="modal-body">
				<input type="number" id="id" name="id" class="hidden"/>
				<div class="form-group required">
					<label for="company" class="col-sm-3 control-label">Company</label>
					<div class="col-sm-9">
						<input type="text" class="form-control" id="company" name="company" placeholder="Company" required>
					</div>
				</div>
				<div class="form-group required">
					<label for="address" class="col-sm-3 control-label">Address</label>
					<div class="col-sm-9">
						<input type="text" class="form-control" id="address" name="address" placeholder="Address" required>
					</div>
				</div>
				<div class="form-group">
					<label for="person" class="col-sm-3 control-label">Person</label>
					<div class="col-sm-9">
						<input type="text" class="form-control" id="person" name="person" placeholder="Person">
					</div>
				</div>
				<div class="form-group required">
					<label for="phone" class="col-sm-3 control-label">Phone</label>
					<div class="col-sm-9">
						<input type="text" class="form-control" id="phone" name="phone" placeholder="Phone" required>
					</div>
				</div>
				<div class="form-group">
					<label for="email" class="col-sm-3 control-label">Email</label>
					<div class="col-sm-9">
						<input type="text" class="form-control" id="email" name="email" placeholder="Email">
					</div>
				</div>
				<div class="form-group">
					<label for="rate" class="col-sm-3 control-label">Rate</label>
					<div class="col-sm-9">
						<input type="number" class="form-control" id="rate" name="rate" placeholder="Rate">
					</div>
				</div>
				<div class="form-group">
					<label for="state" class="col-sm-3 control-label">State</label>
					<div class="col-sm-9">
						<input type="checkbox" name="state" checked> 
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="submit" class="btn btn-primary">Save changes</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			</div>
		</form>
	</div>
</div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- FooTable -->
	<script src="js/footable.min.js"></script>
	<!-- Input mask -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/jquery.inputmask.bundle.js"></script>
	<!-- Font Awesome -->
	<script src="https://use.fontawesome.com/359d0c40d1.js"></script>
	<!-- Bootstrapswitch -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.4/js/bootstrap-switch.min.js"></script>
	<script>
		var $modal = $('#editor-modal'),
		$editor = $('#editor'),
		$editorTitle = $('#editor-title'),
		ft = FooTable.init('#fooTable', {
			filtering: {
				enabled: true,
				exactMatch: false,
				placeholder: "Search"
			},
			paging: {
				enabled: true,
				limit: 3
			},
			sorting: {
				enabled: true
			},
			columns: $.get('columns.json'),
			rows: $.ajax({
				type: 'GET',
				dataType: 'json',
				url: 'http://85.132.64.10/api/v1/users',
				cache: false,
				success: function(){
					console.log('Success');
				},
				error: function(err){
					console.log(err);
				}
			}),
			editing: {
				enabled: true,
				addRow: function(){
					$modal.removeData('row');
					$editor[0].reset();
					$editorTitle.text('Add a new user');
					$modal.modal('show');
				},
				editRow: function(row){
					var values = row.val();
					$editor.find('#id').val(values.id);
					$editor.find('#company').val(values.company);
					$editor.find('#address').val(values.address);
					$editor.find('#person').val(values.person);
					$editor.find('#phone').val(values.phone);
					$editor.find('#email').val(values.email);
					$editor.find('#rate').val(values.rate);
					$editor.find('#state').val(values.state);
					$modal.data('row', row);
					$editorTitle.text('Update: ' + values.company + ' # ' + values.username);
					$modal.modal('show');
				},
				deleteRow: function(row){
					var values = row.val();
					if (confirm('Are you sure you want to delete the user?')){
						row.delete();
						$.ajax({
							method: 'DELETE',
							url: "http://85.132.64.10/api/v1/users",
							contentType: 'aplication/json',
							data: JSON.stringify({id: values.id, company: values.company, username: values.username}),
							success: function(data){
								alert('Client with ID ' + values.id + ' successfuly deleted');
								console.log(data);
								//alertSuccess();
							},
							error: function(err){
								console.log(err);
							}
						})
					}
				}
			}
		}),
		uid = 10;

	$editor.on('submit', function(e){
		if (this.checkValidity && !this.checkValidity()) return;
		e.preventDefault();
		var row = $modal.data('row'),
			values = {
				id: $editor.find('#id').val(),
				company: $editor.find('#company').val(),
				address: $editor.find('#address').val(),
				person: $editor.find('#person').val(),
				phone: $editor.find('#phone').val(),
				email: $editor.find('#email').val(),
				rate: $editor.find('#rate').val(),
				state: $editor.find('#state').val()
			};

        $.ajax({
          method: 'PUT',
          url: "http://85.132.64.10/api/update/" + values.id,
          contentType: 'aplication/json',
          data: JSON.stringify(values),
          success: function(){
            console.log('Client with ID ' + ': ' + values.id + ' successfuly updated');
          },
          error: function(err){
            console.log(err);
          }
        });

		if (row instanceof FooTable.Row){
			row.val(values);
		} else {
			values.id = uid++;
			ft.rows.add(values);
		}
		$modal.modal('hide');
	});
	Inputmask({"mask": "(099)999-99-99"}).mask($('#phone'));
	Inputmask("email").mask($('#email'));
	$("[name='state']").bootstrapSwitch({
		onColor: 'success',
		onSwitchChange: function(){
			alert('Hello');
		}
	});
	</script>
	<script>
		
	</script>
  </body>
</html>
